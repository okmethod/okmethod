# アーキテクチャ設計の心得

## 大原則： 正解を探すのではなく、ベターな最適解を選び抜く！

- 正解のアーキテクチャ（銀の弾丸）は存在せず、その時点で最も良い（悪くない）ものを選ぶしかない
- 考慮すべき品質特性(-ility) を知り、トレードオフを踏まえて意思決定する
- すべての具体的なアーキテクチャは個別解であり、それを考えるために一般解(アーキテクチャパターン) を知る
- 良い設計とは、状況の変化に合わせて変化（進化）させやすい設計である
- 「なぜこの設計にしたのか」という背景と根拠を記録し、将来の変更に備える

---

## 前提： 本ガイドにおける用語の定義について

システム開発において「設計（Design）」や「アーキテクチャ（Architecture）」という言葉は、文脈によって指す範囲が大きく異なる。  
本ガイドでは、「設計の粒度」と「変更に伴うコスト」に基づいて、以下の 3 つの階層に分類してまとめている。

- `Organization / 組織構造 / 物理境界`
  - 視点: 複数コンポーネントが連動・強調して動くシステム全体。組織構造やインフラ戦略と密接に関わる。
  - 役割: システムの物理的な境界線を引き、インフラや技術スタックの選定を通じてシステムの全体像を決定する。
  - 決定後の変更コスト: 特大
  - 有力な武器: エンタープライズ・アーキテクチャパターン
  - キーワード: モノリス vs マイクロサービス、オンプレミス vs クラウドネイティブ
- `Layout / 内部構造 / 論理境界`
  - 視点: 単一コンポーネントの内部構造。変更容易性やテスト容易性と密接に関わる。
  - 役割: 業務要件（ドメインモデル）をコード上で表現するための、論理的な分割（区画整理）と依存関係を整理する。
  - 決定後の変更コスト: 大
  - 有力な武器: アプリケーション・アーキテクチャパターン、構造に関する GoF デザインパターン
  - キーワード: レイヤードアーキテクチャ、ディレクトリ構成、依存の方向性
- `Mechanics / 力学 / 横断的法則`
  - 視点: システムの「品質特性(-ility)」を支える、普遍的な物理法則または経験則。トレードオフの判断と密接に関わる。
  - 役割: 非機能要件（信頼性、整合性など）の優先順位とバランスを適切に決めるための戦略・判断基準を提供する。
  - 決定後の変更コスト: 中
  - 強力な武器: インテグレーションパターン、振る舞いに関する GoF デザインパターン
  - キーワード: エラー時のリトライ方針、整合性モデル

また、前工程（要件定義）から後工程（実装）への流れの中で、本ガイドの位置付けは以下の通りとなる。

- Input: システム要件 (What) ・・・ [要件定義の心得](../planning-principles/README.md) 参照
- Process: アーキテクチャ設計 (How - 概念:Concept) ・・・本ガイド
- Output: コード実装 (How - 実体:Substance) ・・・ [コーディングの心得](./development-domains/coding-principles/README.md)

---

## [organization: どのように組織構造の境界を設計するか](./assets/01-organization.md)

コンセプト: **_強力なアーキテクチャスタイルと技術スタックの選定ポイントを押さえ、システムの物理的な境界線を慎重に決定する_**

トピック:

- アーキテクチャスタイル選定: 組織の規模とフェーズに合わせて、システムの分割単位（デプロイメント単位）を決める
- 技術選定: 「新しさ」ではなく「信頼性」と「習熟度」で技術を選ぶ
- インフラ構築: 手作業を排除し、再現可能なインフラを作ることをデプロイ戦略に組み込む

## [layout: どのように内部構造を区画整理するか](./assets/02-layout.md)

コンセプト: **_コンポーネント内部の関心を分離し、ドメインの複雑性をシンプルに表現する_**

トピック:

- レイヤー設計: 責務を分離し、依存の方向を制御して、変更容易性とテスト容易性を高める
- モジュール分割: 機能（ビジネスドメイン）単位でコードをまとめ、高凝集・低結合な構造を作る
- データモデル配置: ドメインの知識をどこに置くかを明確にする

## [mechanics: どのように品質特性のバランスをとるか](./assets/03-mechanics.md)

コンセプト: **_トレードオフの力学を理解し、システムに求められる品質特性(-ility)を実現する_**

トピック:

- 整合性と信頼性: 分散システムにおける「完全な整合性」を諦め、現実的な解を選ぶ
- 可観測性: 「何が起きているか」ではなく「なぜ起きているか」を知るための仕組みを入れる
- セキュリティと回復性: 「安全である」と過信せず、「侵害される前提」で設計する

---

## 参考

- [O'Reilly Japan ソフトウェアアーキテクチャの基礎](https://www.oreilly.co.jp//books/9784873119823/)
- [O'Reilly Japan データ指向アプリケーションデザイン](https://www.oreilly.co.jp/books/9784873118703/)
- [ソフトウェアアーキテクトが知るべき 97 のこと](https://ソフトウェアアーキテクトが知るべき97のこと.com)
- [アーキテクチャを設計するといふこと 2025 年版](https://www.docswell.com/s/tyonekubo/ZX63WR-architecting-2025)
